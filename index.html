<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–ö–∏–Ω–æ –ö–≤–∏–∑ –¢–µ—Å—Ç</title>
    <style>
        body { font-family: Arial; padding: 20px; text-align: center; }
        button { padding: 15px 30px; font-size: 18px; margin: 10px; }
    </style>
</head>
<body>
    <h1>üé¨ –¢–µ—Å—Ç —Å–≤—è–∑–∏ —Å –±–æ—Ç–æ–º</h1>
    <p>ID —Ç–µ—Å—Ç–∞: <span id="testId">1</span></p>
    
    <button onclick="sendTest(1)">üì® –¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ</button><br>
    <button onclick="sendTest(2)">üéÆ –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button><br>
    <button onclick="sendTest(3)">üîÑ –¢–µ—Å—Ç 3: JSON –¥–∞–Ω–Ω—ã–µ</button>
    
    <div id="status" style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 10px;">
        –ñ–¥—É –¥–µ–π—Å—Ç–≤–∏–π...
    </div>
    
    <script src="https://telegram.org/js/telegram-web-app.js?2"></script>
    <script>
        const tg = window.Telegram.WebApp;
        let testCounter = 1;
        
        tg.expand();
        tg.enableClosingConfirmation();
        
        function updateStatus(text) {
            document.getElementById('status').innerHTML = `[${new Date().toLocaleTimeString()}] ${text}`;
            console.log("Status:", text);
        }
        
        function sendTest(type) {
            testCounter++;
            document.getElementById('testId').textContent = testCounter;
            
            let testData;
            
            switch(type) {
                case 1:
                    testData = {action: "simple_test", counter: testCounter};
                    updateStatus("üîÑ –û—Ç–ø—Ä–∞–≤–ª—è—é –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç...");
                    break;
                case 2:
                    testData = {action: "create_room", user: "TestUser", time: new Date().toISOString()};
                    updateStatus("üè† –°–æ–∑–¥–∞—é —Ç–µ—Å—Ç–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É...");
                    break;
                case 3:
                    testData = {
                        type: "complex_json",
                        data: {test: true, number: testCounter, array: [1,2,3]},
                        meta: {source: "mini_app", version: "1.0"}
                    };
                    updateStatus("üìä –û—Ç–ø—Ä–∞–≤–ª—è—é —Å–ª–æ–∂–Ω—ã–π JSON...");
                    break;
            }
            
            console.log(`üì§ –¢–µ—Å—Ç #${testCounter}:`, testData);
            
            // –û–¢–ü–†–ê–í–ö–ê –î–ê–ù–ù–´–• –ë–û–¢–£
            tg.sendData(JSON.stringify(testData));
            
            updateStatus("‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –ñ–¥—É –æ—Ç–≤–µ—Ç–∞...");
        }
        
        // –°–õ–£–®–ê–¢–ï–õ–¨ –û–¢–í–ï–¢–û–í
        tg.onEvent('webAppDataReceived', (event) => {
            console.log("üì• –û—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞:", event.data);
            updateStatus("üéâ –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞!");
            
            try {
                const data = JSON.parse(event.data);
                alert(`–ë–æ—Ç –æ—Ç–≤–µ—Ç–∏–ª!\n–¢–µ—Å—Ç #${data.counter || '?'}\n${JSON.stringify(data, null, 2)}`);
            } catch (e) {
                alert("–û—Ç–≤–µ—Ç: " + event.data);
            }
        });
        
        tg.ready();
        updateStatus("‚úÖ Mini App –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ");
        console.log("Mini App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω", tg.initDataUnsafe);
        
        // –ê–≤—Ç–æ-—Ç–µ—Å—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            console.log("–ê–≤—Ç–æ-—Ç–µ—Å—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...");
            updateStatus("‚è∞ –ê–≤—Ç–æ-—Ç–µ—Å—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫...");
        }, 3000);
    </script>
</body>
</html>

