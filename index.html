<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ –ö–∏–Ω–æ –ö–≤–∏–∑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px 20px;
            margin: 10px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-create {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
        }
        
        .btn-join {
            background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
        }
        
        .btn-rules {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
        }
        
        .room-code {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 12px;
            border: 2px dashed #667eea;
        }
        
        .code-display {
            font-size: 2rem;
            font-weight: bold;
            letter-spacing: 3px;
            color: #667eea;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            font-family: monospace;
        }
        
        .player-list {
            margin: 20px 0;
        }
        
        .player-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            margin: 8px 0;
            background: #f5f5f5;
            border-radius: 8px;
            transition: background 0.2s;
        }
        
        .player-item:hover {
            background: #e9e9e9;
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .player-name {
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .player-count {
            text-align: center;
            font-size: 1.2rem;
            color: #667eea;
            margin: 15px 0;
            font-weight: 600;
        }
        
        .back-btn {
            background: #757575;
            margin-top: 20px;
        }
        
        .input-code {
            width: 100%;
            padding: 15px;
            margin: 20px 0;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 1.2rem;
            text-align: center;
            letter-spacing: 3px;
            text-transform: uppercase;
        }
        
        .input-code:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            text-align: center;
        }
        
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            text-align: center;
        }
        
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
        }
        
        .question-number {
            color: #667eea;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .question-text {
            font-size: 1.3rem;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .option-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 8px 0;
            text-align: left;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option-btn:hover {
            background: #e9ecef;
        }
        
        .option-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .option-btn.correct {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .option-btn.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }
        
        .results-card {
            text-align: center;
        }
        
        .winner {
            font-size: 2rem;
            color: #FFD700;
            margin: 20px 0;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .results-table th {
            background: #667eea;
            color: white;
            padding: 12px;
        }
        
        .results-table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }
        
        .results-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .results-table .current-player {
            background: #e3f2fd;
            font-weight: bold;
        }
        
        .medal {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .question-text {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="main-screen" class="screen">
            <div class="header">
                <h1>üé¨ –ö–∏–Ω–æ –ö–≤–∏–∑</h1>
                <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –∫–∏–Ω–æ —Å –¥—Ä—É–∑—å—è–º–∏!</p>
            </div>
            
            <div class="card">
                <button class="btn btn-create" onclick="showCreateScreen()">
                    üè† –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É
                </button>
                <button class="btn btn-join" onclick="showJoinScreen()">
                    üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ
                </button>
                <button class="btn btn-rules" onclick="showRulesScreen()">
                    ‚ùì –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã
                </button>
            </div>
            
            <div class="footer">
                <p>–î–æ 6 –∏–≥—Ä–æ–∫–æ–≤ ‚Ä¢ 10 –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Ä¢ –û–Ω–ª–∞–π–Ω –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
            </div>
        </div>
        
        <div id="create-screen" class="screen hidden">
            <div class="header">
                <h1>üè† –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</h1>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π</p>
            </div>
            
            <div class="card">
                <div class="loading" id="creating-loading">
                    –°–æ–∑–¥–∞—é –∫–æ–º–Ω–∞—Ç—É...
                </div>
                
                <div id="room-created" class="hidden">
                    <div class="room-code">
                        <p>–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</p>
                        <div class="code-display" id="room-code-display"></div>
                        <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –¥—Ä—É–∑—å—è–º</p>
                    </div>
                    
                    <div class="player-count">
                        <span id="player-count">1</span>/6 –∏–≥—Ä–æ–∫–æ–≤
                    </div>
                    
                    <div class="player-list" id="players-list">
                        <!-- –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>
                    
                    <button class="btn btn-create" id="start-game-btn" onclick="startGame()">
                        ‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                    </button>
                    
                    <button class="btn back-btn" onclick="showMainScreen()">
                        üîô –ù–∞–∑–∞–¥
                    </button>
                </div>
            </div>
        </div>
        
        <div id="join-screen" class="screen hidden">
            <div class="header">
                <h1>üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</h1>
                <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã –æ—Ç –¥—Ä—É–≥–∞</p>
            </div>
            
            <div class="card">
                <input type="text" 
                       class="input-code" 
                       id="room-code-input" 
                       placeholder="–í–í–ï–î–ò–¢–ï –ö–û–î"
                       maxlength="6"
                       onkeyup="this.value = this.value.toUpperCase()">
                
                <button class="btn btn-join" onclick="joinGame()">
                    –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                </button>
                
                <div class="error hidden" id="join-error"></div>
                
                <div id="waiting-room" class="hidden">
                    <div class="success">
                        ‚úÖ –í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∏–≥—Ä–µ!
                    </div>
                    
                    <div class="player-count">
                        –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã...
                    </div>
                    
                    <div class="player-list" id="join-players-list">
                        <!-- –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>
                    
                    <button class="btn back-btn" onclick="leaveRoom()">
                        üîô –í—ã–π—Ç–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
                    </button>
                </div>
                
                <button class="btn back-btn" onclick="showMainScreen()">
                    üîô –ù–∞–∑–∞–¥
                </button>
            </div>
        </div>
        
        <div id="rules-screen" class="screen hidden">
            <div class="header">
                <h1>‚ùì –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h1>
            </div>
            
            <div class="card">
                <div style="line-height: 1.6;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">üé¨ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h3>
                    <ol style="margin-left: 20px; margin-bottom: 20px;">
                        <li style="margin-bottom: 8px;">–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏ –ø–æ–ª—É—á–∏—Ç–µ –∫–æ–¥</li>
                        <li style="margin-bottom: 8px;">–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–¥ –¥—Ä—É–∑—å—è–º (–¥–æ 6 –∏–≥—Ä–æ–∫–æ–≤)</li>
                        <li style="margin-bottom: 8px;">–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É" –∫–æ–≥–¥–∞ –≤—Å–µ –≥–æ—Ç–æ–≤—ã</li>
                        <li style="margin-bottom: 8px;">–û—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ 10 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –∫–∏–Ω–æ</li>
                        <li style="margin-bottom: 8px;">–í—ã–±–∏—Ä–∞–π—Ç–µ –∏–∑ 4 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞</li>
                        <li style="margin-bottom: 8px;">–£–∑–Ω–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫–æ–Ω—Ü–µ –∏–≥—Ä—ã!</li>
                    </ol>
                    
                    <p style="color: #4CAF50; font-weight: bold; margin-top: 20px;">
                        üèÜ –ü–æ–±–µ–¥–∏—Ç —Ç–æ—Ç, –∫—Ç–æ –¥–∞—Å—Ç –±–æ–ª—å—à–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤!
                    </p>
                </div>
                
                <button class="btn back-btn" onclick="showMainScreen()" style="margin-top: 20px;">
                    üîô –ù–∞–∑–∞–¥
                </button>
            </div>
        </div>
        
        <div id="game-screen" class="screen hidden">
            <div id="question-container">
                <!-- –í–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
            
            <div id="results-container" class="hidden">
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <!-- Telegram Web App API -->
    <script src="https://telegram.org/js/telegram-web-app.js?2"></script>
    
    <script>
        // Telegram Web App API
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let currentRoomCode = null;
        let isCreator = false;
        let currentQuestion = 0;
        let questions = [];
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        function showMainScreen() {
            hideAllScreens();
            document.getElementById('main-screen').classList.remove('hidden');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã
        function showCreateScreen() {
            hideAllScreens();
            document.getElementById('create-screen').classList.remove('hidden');
            createRoom();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function showJoinScreen() {
            hideAllScreens();
            document.getElementById('join-screen').classList.remove('hidden');
            document.getElementById('waiting-room').classList.add('hidden');
            document.getElementById('join-error').classList.add('hidden');
            document.getElementById('room-code-input').value = '';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª
        function showRulesScreen() {
            hideAllScreens();
            document.getElementById('rules-screen').classList.remove('hidden');
        }
        
        // –°–∫—Ä—ã—Ç—å –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
        }
        
        // –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
        function createRoom() {
            tg.showPopup({
                title: '–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã',
                message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...',
                buttons: []
            });
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –±–æ—Ç—É —á–µ—Ä–µ–∑ Telegram API
            tg.sendData(JSON.stringify({
                action: 'create_room',
                user: tg.initDataUnsafe.user
            }));
        }
        
        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ
        function joinGame() {
            const roomCode = document.getElementById('room-code-input').value.trim().toUpperCase();
            
            if (!roomCode || roomCode.length !== 6) {
                showError('–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã');
                return;
            }
            
            tg.showPopup({
                title: '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ',
                message: '–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –∏–≥—Ä–µ...',
                buttons: []
            });
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –±–æ—Ç—É
            tg.sendData(JSON.stringify({
                action: 'join_room',
                room_code: roomCode,
                user: tg.initDataUnsafe.user
            }));
        }
        
        // –ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É
        function leaveRoom() {
            if (currentRoomCode) {
                tg.sendData(JSON.stringify({
                    action: 'leave_room',
                    room_code: currentRoomCode
                }));
            }
            showJoinScreen();
        }
        
        // –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
        function startGame() {
            if (!currentRoomCode) return;
            
            tg.showPopup({
                title: '–ù–∞—á–∞–ª–æ –∏–≥—Ä—ã',
                message: '–ó–∞–ø—É—Å–∫–∞–µ–º –∫–≤–∏–∑...',
                buttons: []
            });
            
            tg.sendData(JSON.stringify({
                action: 'start_game',
                room_code: currentRoomCode
            }));
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            const errorDiv = document.getElementById('join-error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞
        tg.onEvent('webAppDataReceived', (event) => {
            try {
                const data = JSON.parse(event.data);
                handleBotData(data);
            } catch (e) {
                console.error('Error parsing bot data:', e);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞
        function handleBotData(data) {
            console.log('Received from bot:', data);
            
            switch (data.type) {
                case 'room_created':
                    handleRoomCreated(data);
                    break;
                case 'room_joined':
                    handleRoomJoined(data);
                    break;
                case 'player_joined':
                    updatePlayerList(data);
                    break;
                case 'game_started':
                    startQuiz(data);
                    break;
                case 'question':
                    showQuestion(data);
                    break;
                case 'results':
                    showResults(data);
                    break;
                case 'error':
                    tg.showPopup({
                        title: '–û—à–∏–±–∫–∞',
                        message: data.message,
                        buttons: [{ type: 'ok' }]
                    });
                    break;
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã
        function handleRoomCreated(data) {
            currentRoomCode = data.room_code;
            isCreator = true;
            
            document.getElementById('creating-loading').classList.add('hidden');
            document.getElementById('room-created').classList.remove('hidden');
            document.getElementById('room-code-display').textContent = data.room_code;
            
            updatePlayerList(data);
            
            tg.showPopup({
                title: '–ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞!',
                message: `–ö–æ–¥: ${data.room_code}\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –¥—Ä—É–∑—å—è–º`,
                buttons: [{ type: 'ok' }]
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∫–æ–º–Ω–∞—Ç–µ
        function handleRoomJoined(data) {
            currentRoomCode = data.room_code;
            isCreator = false;
            
            document.getElementById('waiting-room').classList.remove('hidden');
            document.getElementById('join-error').classList.add('hidden');
            updateJoinPlayerList(data);
            
            tg.showPopup({
                title: '–£—Å–ø–µ—à–Ω–æ!',
                message: '–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∏–≥—Ä–µ',
                buttons: [{ type: 'ok' }]
            });
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ (–¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è)
        function updatePlayerList(data) {
            const playersList = document.getElementById('players-list');
            const playerCount = document.getElementById('player-count');
            
            if (data.players && Array.isArray(data.players)) {
                playersList.innerHTML = '';
                data.players.forEach(player => {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'player-item';
                    playerDiv.innerHTML = `
                        <div class="player-avatar">${player.username.charAt(0).toUpperCase()}</div>
                        <div class="player-name">${player.username}</div>
                    `;
                    playersList.appendChild(playerDiv);
                });
                
                playerCount.textContent = data.players.length;
                
                // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É" –µ—Å–ª–∏ –µ—Å—Ç—å –∏–≥—Ä–æ–∫–∏
                document.getElementById('start-game-btn').disabled = data.players.length < 1;
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ (–¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–≤—à–∏—Ö—Å—è)
        function updateJoinPlayerList(data) {
            const playersList = document.getElementById('join-players-list');
            
            if (data.players && Array.isArray(data.players)) {
                playersList.innerHTML = '';
                data.players.forEach(player => {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'player-item';
                    playerDiv.innerHTML = `
                        <div class="player-avatar">${player.username.charAt(0).toUpperCase()}</div>
                        <div class="player-name">${player.username}</div>
                    `;
                    playersList.appendChild(playerDiv);
                });
            }
        }
        
        // –ù–∞—á–∞—Ç—å –∫–≤–∏–∑
        function startQuiz(data) {
            hideAllScreens();
            document.getElementById('game-screen').classList.remove('hidden');
            questions = data.questions || [];
            currentQuestion = 0;
            
            if (questions.length > 0) {
                showQuestion({
                    question: questions[0],
                    question_number: 1,
                    total_questions: questions.length
                });
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–æ–ø—Ä–æ—Å
        function showQuestion(data) {
            const container = document.getElementById('question-container');
            const question = data.question;
            
            let optionsHtml = '';
            question.options.forEach((option, index) => {
                optionsHtml += `
                    <button class="option-btn" onclick="selectAnswer(${index})">
                        ${option}
                    </button>
                `;
            });
            
            container.innerHTML = `
                <div class="question-card">
                    <div class="question-number">
                        –í–æ–ø—Ä–æ—Å ${data.question_number} –∏–∑ ${data.total_questions}
                    </div>
                    <div class="question-text">
                        ${question.question}
                    </div>
                    ${optionsHtml}
                </div>
            `;
        }
        
        // –í—ã–±—Ä–∞—Ç—å –æ—Ç–≤–µ—Ç
        function selectAnswer(answerIndex) {
            tg.sendData(JSON.stringify({
                action: 'answer_question',
                room_code: currentRoomCode,
                question_index: currentQuestion,
                answer_index: answerIndex
            }));
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            buttons[answerIndex].classList.add('selected');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        function showResults(data) {
            const container = document.getElementById('results-container');
            
            let tableRows = '';
            data.results.forEach((player, index) => {
                let medal = '';
                if (index === 0) medal = 'ü•á ';
                else if (index === 1) medal = 'ü•à ';
                else if (index === 2) medal = 'ü•â ';
                
                const isCurrent = player.username === tg.initDataUnsafe.user?.first_name;
                const rowClass = isCurrent ? 'current-player' : '';
                
                tableRows += `
                    <tr class="${rowClass}">
                        <td>${index + 1}</td>
                        <td>${medal}${player.username}</td>
                        <td>${player.score}/10</td>
                    </tr>
                `;
            });
            
            container.innerHTML = `
                <div class="card results-card">
                    <h2 style="color: #667eea; margin-bottom: 20px;">üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä—ã</h2>
                    
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>–ú–µ—Å—Ç–æ</th>
                                <th>–ò–≥—Ä–æ–∫</th>
                                <th>–û—á–∫–∏</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                    
                    <div style="margin: 30px 0;">
                        <p style="font-size: 1.2rem; color: #4CAF50;">
                            ${data.is_winner ? 'üèÜ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–±–µ–¥–∏–ª–∏!' : 'üéâ –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É!'}
                        </p>
                    </div>
                    
                    <button class="btn btn-create" onclick="playAgain()">
                        üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                    
                    <button class="btn back-btn" onclick="showMainScreen()">
                        üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
                    </button>
                </div>
            `;
            
            document.getElementById('question-container').classList.add('hidden');
            container.classList.remove('hidden');
        }
        
        // –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
        function playAgain() {
            currentRoomCode = null;
            isCreator = false;
            showMainScreen();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        tg.ready();
        showMainScreen();
    </script>
</body>
</html>
