<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ –ö–∏–Ω–æ –ö–≤–∏–∑</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: center;
            text-decoration: none;
            color: white;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .btn-primary {
            background: #4CAF50;
        }
        .btn-secondary {
            background: #2196F3;
        }
        .btn-danger {
            background: #f44336;
        }
        .btn-info {
            background: #00bcd4;
        }
        .room-code {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        .code {
            font-size: 2em;
            font-weight: bold;
            letter-spacing: 5px;
            margin: 10px 0;
            color: #FFD700;
        }
        .player-list {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .player-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .player-item:last-child {
            border-bottom: none;
        }
        .question {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .option-btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .option-btn:hover {
            background: #f5f5f5;
        }
        .option-btn.correct {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        .option-btn.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }
        .results {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .result-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .result-item.winner {
            background: #FFF9C4;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <div class="header">
            <h1>üé¨ –ö–∏–Ω–æ –ö–≤–∏–∑</h1>
            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –∫–∏–Ω–æ!</p>
        </div>
        
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="mainMenu">
            <button class="btn btn-primary" onclick="showScreen('createGame')">üè† –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</button>
            <button class="btn btn-secondary" onclick="showScreen('joinGame')">üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
            <button class="btn btn-info" onclick="showScreen('rules')">‚ùì –ü—Ä–∞–≤–∏–ª–∞</button>
        </div>
        
        <!-- –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã -->
        <div id="createGame" style="display: none;">
            <div class="room-code">
                <h3>–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</h3>
                <div class="code" id="roomCode">XXXXXX</div>
                <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –¥—Ä—É–∑—å—è–º!</p>
            </div>
            <div class="player-list" id="playerList">
                <h3>–ò–≥—Ä–æ–∫–∏:</h3>
                <div class="player-item">üë§ –í—ã (–°–æ–∑–¥–∞—Ç–µ–ª—å)</div>
            </div>
            <button class="btn btn-primary" onclick="startGame()">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            <button class="btn btn-danger" onclick="showScreen('mainMenu')">üîô –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∏–≥—Ä–µ -->
        <div id="joinGame" style="display: none;">
            <h3>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</h3>
            <input type="text" id="roomCodeInput" placeholder="XXXXXX" style="width: 100%; padding: 15px; font-size: 18px; text-align: center; border-radius: 10px; border: none; margin: 20px 0;">
            <button class="btn btn-primary" onclick="joinRoom()">‚úÖ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
            <button class="btn btn-danger" onclick="showScreen('mainMenu')">üîô –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ -->
        <div id="waitingRoom" style="display: none;">
            <div class="room-code">
                <h3>–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</h3>
                <div class="code" id="waitingRoomCode">XXXXXX</div>
            </div>
            <div class="player-list" id="waitingPlayers">
                <h3>–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</h3>
            </div>
            <button class="btn btn-danger" onclick="leaveRoom()">üö™ –í—ã–π—Ç–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã</button>
        </div>
        
        <!-- –í–æ–ø—Ä–æ—Å -->
        <div id="questionScreen" style="display: none;">
            <div class="question">
                <h3 id="questionText">–í–æ–ø—Ä–æ—Å –±—É–¥–µ—Ç –∑–¥–µ—Å—å...</h3>
                <div id="optionsContainer"></div>
            </div>
        </div>
        
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div id="resultsScreen" style="display: none;">
            <div class="results">
                <h2>üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
                <div id="resultsList"></div>
                <button class="btn btn-primary" onclick="playAgain()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                <button class="btn btn-danger" onclick="showScreen('mainMenu')">üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∏–ª–∞ -->
        <div id="rules" style="display: none;">
            <div class="question">
                <h3>üé¨ –ü—Ä–∞–≤–∏–ª–∞ –ö–∏–Ω–æ –ö–≤–∏–∑–∞</h3>
                <p>1. –ò–≥—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç 1 –¥–æ 6 –∏–≥—Ä–æ–∫–æ–≤</p>
                <p>2. –ö–≤–∏–∑ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 10 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –∫–∏–Ω–æ</p>
                <p>3. –í –∫–∞–∂–¥–æ–º –≤–æ–ø—Ä–æ—Å–µ 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞</p>
                <p>4. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç</p>
                <p>5. –ó–∞ –∫–∞–∂–¥—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç - 1 –æ—á–∫–æ</p>
                <p>6. –í –∫–æ–Ω—Ü–µ - —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
                <button class="btn btn-danger" onclick="showScreen('mainMenu')">üîô –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>
    
    <script>
        let currentRoomCode = '';
        let isCreator = false;
        
        // –ü–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–æ–≤
        function showScreen(screenId) {
            document.querySelectorAll('div[id]').forEach(div => {
                div.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'block';
            
            if (screenId === 'createGame') {
                createNewRoom();
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–Ω–∞—Ç—ã
        function createNewRoom() {
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–æ–¥–∞
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            currentRoomCode = code;
            document.getElementById('roomCode').textContent = code;
            isCreator = true;
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ –±–æ—Ç–∞
            if (window.Telegram.WebApp) {
                window.Telegram.WebApp.sendData(JSON.stringify({
                    action: 'create_room',
                    room_code: code
                }));
            }
        }
        
        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
        function joinRoom() {
            const code = document.getElementById('roomCodeInput').value.toUpperCase();
            if (code.length === 6) {
                currentRoomCode = code;
                isCreator = false;
                
                document.getElementById('waitingRoomCode').textContent = code;
                showScreen('waitingRoom');
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                if (window.Telegram.WebApp) {
                    window.Telegram.WebApp.sendData(JSON.stringify({
                        action: 'join_room',
                        room_code: code
                    }));
                }
            } else {
                alert('–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥!');
            }
        }
        
        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            if (window.Telegram.WebApp && isCreator) {
                window.Telegram.WebApp.sendData(JSON.stringify({
                    action: 'start_game',
                    room_code: currentRoomCode
                }));
            }
        }
        
        // –í—ã—Ö–æ–¥ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
        function leaveRoom() {
            if (window.Telegram.WebApp) {
                window.Telegram.WebApp.sendData(JSON.stringify({
                    action: 'leave_room',
                    room_code: currentRoomCode
                }));
            }
            showScreen('mainMenu');
        }
        
        // –ù–æ–≤–∞—è –∏–≥—Ä–∞
        function playAgain() {
            showScreen('mainMenu');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞
            Telegram.WebApp.onEvent('message', (data) => {
                try {
                    const message = JSON.parse(data);
                    handleBotMessage(message);
                } catch (e) {
                    console.error('Error parsing message:', e);
                }
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –±–æ—Ç–∞
        function handleBotMessage(message) {
            switch(message.type) {
                case 'question':
                    showQuestion(message);
                    break;
                case 'results':
                    showResults(message);
                    break;
                case 'player_joined':
                    updatePlayerList(message.players);
                    break;
                case 'game_started':
                    alert('–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!');
                    break;
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–æ–ø—Ä–æ—Å
        function showQuestion(data) {
            document.getElementById('questionText').textContent = `–í–æ–ø—Ä–æ—Å ${data.index + 1}/10: ${data.question}`;
            
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            data.options.forEach((option, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => selectAnswer(idx, data.index);
                container.appendChild(btn);
            });
            
            showScreen('questionScreen');
        }
        
        // –í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞
        function selectAnswer(answerIndex, questionIndex) {
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç—É
            if (window.Telegram.WebApp) {
                window.Telegram.WebApp.sendData(JSON.stringify({
                    action: 'answer',
                    room_code: currentRoomCode,
                    question_index: questionIndex,
                    answer_index: answerIndex
                }));
            }
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach((btn, idx) => {
                if (idx === answerIndex) {
                    btn.classList.add('selected');
                }
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        function showResults(data) {
            const container = document.getElementById('resultsList');
            container.innerHTML = '';
            
            data.players.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'result-item' + (index === 0 ? ' winner' : '');
                
                let medal = '';
                if (index === 0) medal = 'ü•á ';
                else if (index === 1) medal = 'ü•à ';
                else if (index === 2) medal = 'ü•â ';
                
                div.innerHTML = `
                    <strong>${index + 1}. ${medal}${player.name}</strong>
                    <span style="float: right;">${player.score}/10</span>
                `;
                container.appendChild(div);
            });
            
            showScreen('resultsScreen');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
        function updatePlayerList(players) {
            const container = document.getElementById('waitingPlayers');
            container.innerHTML = '<h3>–ò–≥—Ä–æ–∫–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ:</h3>';
            
            players.forEach(player => {
                const div = document.createElement('div');
                div.className = 'player-item';
                div.textContent = `üë§ ${player}`;
                container.appendChild(div);
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        showScreen('mainMenu');
    </script>
</body>
</html>